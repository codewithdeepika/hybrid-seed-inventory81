
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hybrid Seed Inventory Pro - Enhanced</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Base Styles */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f7fa;
      color: #333;
      transition: all 0.3s ease;
    }
    
    body[data-theme="dark"] {
      background-color: #1a1a1a;
      color: #f0f0f0;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #e1e1e1;
    }
    
    body[data-theme="dark"] .header {
      border-bottom-color: #444;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .logo-icon {
      font-size: 2.5rem;
      color: #4CAF50;
    }
    
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .tab-btn {
      padding: 10px 20px;
      background: #e1e1e1;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }
    
    body[data-theme="dark"] .tab-btn {
      background: #333;
      color: #f0f0f0;
    }
    
    .tab-btn.active {
      background: #4CAF50;
      color: white;
    }
    
    body[data-theme="dark"] .tab-btn.active {
      background: #2E7D32;
    }
    
    .tab-btn:hover {
      opacity: 0.9;
    }
    
    .tab-content {
      display: none;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    body[data-theme="dark"] .tab-content {
      background: #2a2a2a;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    
    .tab-content.active {
      display: block;
    }
    
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 15px;
      background: #333;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 1000;
    }
    
    /* Modal Styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
    }
    
    body[data-theme="dark"] .modal-content {
      background: #2a2a2a;
      color: #f0f0f0;
    }
    
    .modal-header {
      margin-bottom: 20px;
    }
    
    .modal-footer {
      margin-top: 20px;
      text-align: right;
    }
    
    .password-input {
      position: relative;
    }
    
    .password-toggle {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      color: #666;
    }
    
    /* Entry Actions */
    .entry-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    
    .btn-sm {
      padding: 5px 10px;
      font-size: 14px;
    }
    
    .btn-edit {
      background: #2196F3;
    }
    
    .btn-delete {
      background: #f44336;
    }
    
    /* Toast Notifications */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 15px;
      border-radius: 5px;
      color: white;
      z-index: 1000;
      animation: slideIn 0.3s, fadeOut 0.5s 2.5s forwards;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .toast-success {
      background: #4CAF50;
    }
    
    .toast-error {
      background: #f44336;
    }
    
    .toast-warning {
      background: #ff9800;
    }
    
    .toast-info {
      background: #2196F3;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); }
      to { transform: translateX(0); }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    
    /* Enhanced Profit & Loss Dashboard Styles */
    .profit-dashboard {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 15px;
      padding: 25px;
      margin: 20px 0;
      color: white;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    
    .profit-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .metric-card {
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      backdrop-filter: blur(10px);
    }
    
    .metric-value {
      font-size: 24px;
      font-weight: bold;
      margin: 10px 0;
    }
    
    .metric-label {
      font-size: 14px;
      opacity: 0.8;
    }
    
    /* AI Assistant Styles */
    .ai-assistant {
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      color: white;
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }
    
    .ai-features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .ai-feature {
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .ai-feature:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .ai-feature i {
      font-size: 24px;
      margin-bottom: 10px;
    }
    
    .voice-command {
      background: #2d3436;
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      color: #00b894;
      font-family: 'Courier New', monospace;
    }
    
    .chat-container {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      min-height: 300px;
      border: 1px solid #dee2e6;
    }
    
    body[data-theme="dark"] .chat-container {
      background: #2a2a2a;
      border-color: #444;
    }
    
    #chatMessages {
      height: 250px;
      overflow-y: auto;
      margin-bottom: 15px;
    }
    
    .user-message {
      background: #fff3e0;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 10px;
      text-align: right;
    }
    
    body[data-theme="dark"] .user-message {
      background: #333;
    }
    
    .ai-message {
      background: #e3f2fd;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 10px;
    }
    
    body[data-theme="dark"] .ai-message {
      background: #1a3a5a;
    }
    
    .thinking {
      opacity: 0.7;
      font-style: italic;
    }
    
    /* Form Styles */
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    
    body[data-theme="dark"] input,
    body[data-theme="dark"] select,
    body[data-theme="dark"] textarea {
      background: #333;
      color: #f0f0f0;
      border-color: #555;
    }
    
    button {
      padding: 10px 15px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    body[data-theme="dark"] button {
      background: #2E7D32;
    }
    
    button:hover {
      opacity: 0.9;
    }
    
    button.btn-primary {
      background: #2196F3;
    }
    
    body[data-theme="dark"] button.btn-primary {
      background: #0d47a1;
    }
    
    button.btn-success {
      background: #4CAF50;
    }
    
    body[data-theme="dark"] button.btn-success {
      background: #2E7D32;
    }
    
    button.btn-info {
      background: #00bcd4;
    }
    
    body[data-theme="dark"] button.btn-info {
      background: #00838f;
    }
    
    /* Entry Cards */
    .entry-card {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    body[data-theme="dark"] .entry-card {
      background: #333;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }
    
    .entry-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .quantity-badge {
      background: #4CAF50;
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 14px;
    }
    
    /* Chart Containers */
    .chart-container {
      position: relative;
      height: 300px;
      margin-bottom: 30px;
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    body[data-theme="dark"] .chart-container {
      background: #2a2a2a;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }
    
    /* Enhanced Stats */
    .enhanced-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .enhanced-stat-card {
      background: linear-gradient(135deg, #74b9ff, #0984e3);
      border-radius: 15px;
      padding: 20px;
      color: white;
      position: relative;
      overflow: hidden;
    }
    
    .stat-number {
      font-size: 24px;
      font-weight: bold;
      display: block;
      margin: 10px 0;
    }
    
    .stat-label {
      font-size: 14px;
      opacity: 0.8;
    }
    
    /* Floating Action Button */
    .floating-action-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      z-index: 1000;
      animation: pulse 2s infinite;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body>
  <button class="theme-toggle no-print" onclick="toggleTheme()">
    <i class="fas fa-moon"></i>
    <span>Dark Mode</span>
  </button>

  <div class="container" id="mainContainer" style="display: none;">
    <div class="header">
      <div class="logo">
        <div class="logo-icon"><i class="fas fa-seedling"></i></div>
        <div>
          <h1>Hybrid Seed Inventory Pro</h1>
          <p class="subtitle">Comprehensive seed stock management system</p>
        </div>
      </div>
      <div id="currentDateTime"></div>
    </div>

    <!-- Tabs Navigation -->
    <div class="tabs no-print">
      <button class="tab-btn" data-tab="inward" onclick="showTab('inward')">
        <i class="fas fa-arrow-down"></i> Inward
      </button>
      <button class="tab-btn" data-tab="outward" onclick="showTab('outward')">
        <i class="fas fa-arrow-up"></i> Outward
      </button>
      <button class="tab-btn" data-tab="returns" onclick="showTab('returns')">
        <i class="fas fa-undo"></i> Returns
      </button>
      <button class="tab-btn" data-tab="expiry" onclick="showTab('expiry')">
        <i class="fas fa-clock"></i> Expiry
      </button>
      <button class="tab-btn" data-tab="reports" onclick="showTab('reports')">
        <i class="fas fa-chart-bar"></i> Reports
      </button>
      <button class="tab-btn active" data-tab="dashboard" onclick="showTab('dashboard')">
        <i class="fas fa-tachometer-alt"></i> Dashboard
      </button>
      <button class="tab-btn" data-tab="ai-insights" onclick="showTab('ai-insights')">
        <i class="fas fa-brain"></i> AI Insights
      </button>
    </div>

    <!-- Tab Contents -->
    <div id="inward" class="tab-content">
      <h2><i class="fas fa-arrow-down"></i> Inward Entries</h2>
      <form id="inwardForm">
        <div class="form-group">
          <label for="inwardSeedName">Seed Name</label>
          <input type="text" id="inwardSeedName" name="seedName" required>
        </div>
        <div class="form-group">
          <label for="inwardQuantity">Quantity (kg)</label>
          <input type="number" id="inwardQuantity" name="quantity" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="inwardSupplier">Supplier</label>
          <input type="text" id="inwardSupplier" name="party" required>
        </div>
        <div class="form-group">
          <label for="inwardDate">Date</label>
          <input type="date" id="inwardDate" name="date" required>
        </div>
        <div class="form-group">
          <label for="inwardNotes">Notes</label>
          <textarea id="inwardNotes" name="notes" rows="3"></textarea>
        </div>
        <button type="submit">
          <i class="fas fa-plus"></i> Add Entry
        </button>
      </form>
      
      <h3>Recent Inward Entries</h3>
      <div id="inwardEntries">
        <!-- Entries will be loaded here -->
      </div>
    </div>

    <div id="outward" class="tab-content">
      <h2><i class="fas fa-arrow-up"></i> Outward Entries</h2>
      <form id="outwardForm">
        <div class="form-group">
          <label for="outwardSeedName">Seed Name</label>
          <input type="text" id="outwardSeedName" name="seedName" required>
        </div>
        <div class="form-group">
          <label for="outwardQuantity">Quantity (kg)</label>
          <input type="number" id="outwardQuantity" name="quantity" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="outwardCustomer">Customer</label>
          <input type="text" id="outwardCustomer" name="party" required>
        </div>
        <div class="form-group">
          <label for="outwardDate">Date</label>
          <input type="date" id="outwardDate" name="date" required>
        </div>
        <div class="form-group">
          <label for="outwardNotes">Notes</label>
          <textarea id="outwardNotes" name="notes" rows="3"></textarea>
        </div>
        <button type="submit">
          <i class="fas fa-plus"></i> Add Entry
        </button>
      </form>
      
      <h3>Recent Outward Entries</h3>
      <div id="outwardEntries">
        <!-- Entries will be loaded here -->
      </div>
    </div>

    <div id="returns" class="tab-content">
      <h2><i class="fas fa-undo"></i> Return Entries</h2>
      <form id="returnsForm">
        <div class="form-group">
          <label for="returnsSeedName">Seed Name</label>
          <input type="text" id="returnsSeedName" name="seedName" required>
        </div>
        <div class="form-group">
          <label for="returnsQuantity">Quantity (kg)</label>
          <input type="number" id="returnsQuantity" name="quantity" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="returnsReason">Reason</label>
          <input type="text" id="returnsReason" name="reason" required>
        </div>
        <div class="form-group">
          <label for="returnsDate">Date</label>
          <input type="date" id="returnsDate" name="date" required>
        </div>
        <div class="form-group">
          <label for="returnsNotes">Notes</label>
          <textarea id="returnsNotes" name="notes" rows="3"></textarea>
        </div>
        <button type="submit">
          <i class="fas fa-plus"></i> Add Entry
        </button>
      </form>
      
      <h3>Recent Return Entries</h3>
      <div id="returnsEntries">
        <!-- Entries will be loaded here -->
      </div>
    </div>

    <div id="expiry" class="tab-content">
      <h2><i class="fas fa-clock"></i> Expiry Management</h2>
      <form id="expiryForm">
        <div class="form-group">
          <label for="expirySeedName">Seed Name</label>
          <input type="text" id="expirySeedName" name="seedName" required>
        </div>
        <div class="form-group">
          <label for="expiryQuantity">Quantity (kg)</label>
          <input type="number" id="expiryQuantity" name="quantity" step="0.01" required>
        </div>
        <div class="form-group">
          <label for="expiryDate">Date</label>
          <input type="date" id="expiryDate" name="date" required>
        </div>
        <div class="form-group">
          <label for="expiryExpiryDate">Expiry Date</label>
          <input type="date" id="expiryExpiryDate" name="expiryDate" required>
        </div>
        <div class="form-group">
          <label for="expiryAction">Action</label>
          <select id="expiryAction" name="action" required>
            <option value="">Select Action</option>
            <option value="destroyed">Destroyed</option>
            <option value="returned">Returned to Supplier</option>
            <option value="used">Used Before Expiry</option>
          </select>
        </div>
        <div class="form-group">
          <label for="expiryNotes">Notes</label>
          <textarea id="expiryNotes" name="notes" rows="3"></textarea>
        </div>
        <button type="submit">
          <i class="fas fa-plus"></i> Add Entry
        </button>
      </form>
      
      <h3>Recent Expiry Entries</h3>
      <div id="expiryEntries">
        <!-- Entries will be loaded here -->
      </div>
    </div>

    <div id="reports" class="tab-content">
      <h2><i class="fas fa-chart-bar"></i> Reports</h2>
      <div class="chart-container">
        <canvas id="inventoryChart"></canvas>
      </div>
      <div class="chart-container">
        <canvas id="seedChart"></canvas>
      </div>
      <div class="chart-container">
        <canvas id="expiryChart"></canvas>
      </div>
      <div class="chart-container">
        <canvas id="movementChart"></canvas>
      </div>
      <div class="chart-container">
        <canvas id="customerChart"></canvas>
      </div>
      <button onclick="printReport()" class="btn btn-primary">
        <i class="fas fa-print"></i> Print Report
      </button>
      <button onclick="exportData()" class="btn btn-success">
        <i class="fas fa-file-export"></i> Export Data
      </button>
    </div>

    <div id="dashboard" class="tab-content active">
      <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
      
      <div class="enhanced-stats">
        <div class="enhanced-stat-card">
          <span class="stat-number" id="totalStock">0</span>
          <div class="stat-label">Total Stock (kg)</div>
        </div>
        <div class="enhanced-stat-card">
          <span class="stat-number" id="totalInward">0</span>
          <div class="stat-label">Inward Today</div>
        </div>
        <div class="enhanced-stat-card">
          <span class="stat-number" id="totalOutward">0</span>
          <div class="stat-label">Outward Today</div>
        </div>
        <div class="enhanced-stat-card">
          <span class="stat-number" id="expiringSoon">0</span>
          <div class="stat-label">Expiring Soon</div>
        </div>
      </div>
      
      <div class="profit-dashboard">
        <h3><i class="fas fa-chart-line"></i> Profit & Loss Dashboard</h3>
        <div class="profit-metrics">
          <div class="metric-card">
            <div class="metric-label">Total Revenue</div>
            <div class="metric-value" id="totalRevenue">₹0</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Total Costs</div>
            <div class="metric-value" id="totalCosts">₹0</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Gross Profit</div>
            <div class="metric-value" id="grossProfit">₹0</div>
          </div>
          <div class="metric-card">
            <div class="metric-label">Profit Margin</div>
            <div class="metric-value" id="profitMargin">0%</div>
          </div>
        </div>
        <button onclick="generateProfitReport()" class="btn btn-primary">
          <i class="fas fa-sync-alt"></i> Refresh Report
        </button>
      </div>
      
      <div class="chart-container">
        <canvas id="dashboardMovementChart"></canvas>
      </div>
    </div>

    <div id="ai-insights" class="tab-content">
      <h2><i class="fas fa-brain"></i> AI Insights</h2>
      
      <div class="ai-assistant">
        <h3><i class="fas fa-robot"></i> AI-Powered Smart Assistant</h3>
        <p>Get intelligent insights, predictions and recommendations for your inventory management</p>
        
        <div class="ai-features">
          <div class="ai-feature" onclick="askAI('inventory-optimization')">
            <i class="fas fa-chart-pie"></i>
            <strong>Inventory Optimization</strong>
            <p>Get AI recommendations for stock levels</p>
          </div>
          <div class="ai-feature" onclick="askAI('demand-forecasting')">
            <i class="fas fa-crystal-ball"></i>
            <strong>Demand Forecasting</strong>
            <p>Predict future seed demand patterns</p>
          </div>
          <div class="ai-feature" onclick="askAI('profit-analysis')">
            <i class="fas fa-money-bill-trend-up"></i>
            <strong>Profit Analysis</strong>
            <p>Analyze profitability by seed variety</p>
          </div>
          <div class="ai-feature" onclick="askAI('market-insights')">
            <i class="fas fa-globe"></i>
            <strong>Market Insights</strong>
            <p>Get market trends and pricing insights</p>
          </div>
        </div>
        
        <div class="voice-command">
          <i class="fas fa-microphone"></i> Voice Command: "Hey Assistant, show me profit trends"
          <button onclick="startVoiceCommand()" class="btn btn-sm btn-info">
            <i class="fas fa-microphone"></i> Start Voice
          </button>
        </div>
      </div>
      
      <div style="margin-top: 30px;">
        <h3><i class="fas fa-comments"></i> Chat with AI Assistant</h3>
        <div class="chat-container">
          <div id="chatMessages">
            <div class="ai-message">
              <strong>AI Assistant:</strong> Hello! I'm here to help you optimize your seed inventory business. What would you like to know?
            </div>
          </div>
          <div style="display: flex; gap: 10px;">
            <input type="text" id="chatInput" placeholder="Ask me anything about your inventory..." style="flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
            <button onclick="sendChatMessage()" class="btn btn-primary">
              <i class="fas fa-paper-plane"></i> Send
            </button>
            <button onclick="startVoiceInput()" class="btn btn-info">
              <i class="fas fa-microphone"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <button class="floating-action-btn" onclick="showTab('ai-insights')">
    <i class="fas fa-robot"></i>
  </button>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Global variables
    let inventoryData = {
      inward: [],
      outward: [],
      returns: [],
      expiry: []
    };
    
    let charts = {};
    let currentTheme = localStorage.getItem('theme') || 'light';
    let isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
    let currentUser = localStorage.getItem('currentUser') || 'Admin';
    
    // Initialize application
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
    });
    
    function initializeApp() {
      // Check login status
      if (!isLoggedIn) {
        showLoginModal();
        return;
      }
      
      // Load saved data from localStorage
      const savedData = localStorage.getItem('inventoryData');
      if (savedData) {
        inventoryData = JSON.parse(savedData);
      }
      
      // Show main container
      document.getElementById('mainContainer').style.display = 'block';
      
      setDefaultDates();
      initCharts();
      setupEventListeners();
      updateCharts();
      updateProfitDashboard();
      updateDateTime();
      
      // Show dashboard by default
      showTab('dashboard');
      
      if (currentTheme === 'dark') {
        document.body.setAttribute('data-theme', 'dark');
        document.querySelector('.theme-toggle').innerHTML = '<i class="fas fa-sun"></i> <span>Light Mode</span>';
      }
      
      // Check for low inventory periodically
      setInterval(checkLowInventory, 30000);
      setInterval(updateDateTime, 1000);
      checkLowInventory();
      
      showToast('Welcome back, ' + currentUser + '!', 'success');
    }
    
    // Login System
    function showLoginModal() {
      const loginModal = document.createElement('div');
      loginModal.className = 'modal active';
      loginModal.id = 'loginModal';
      loginModal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <h3>Login Required</h3>
          </div>
          <form id="loginForm">
            <div class="form-group">
              <label for="username">Username</label>
              <input type="text" id="username" required placeholder="Enter username">
            </div>
            <div class="form-group">
              <label for="password">Password</label>
              <div class="password-input">
                <input type="password" id="password" required placeholder="Enter password">
                <button type="button" class="password-toggle" onclick="togglePassword()">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-sign-in-alt"></i> Login
              </button>
            </div>
          </form>
        </div>
      `;
      document.body.appendChild(loginModal);
      
      document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        
        if (username === 'admin' && password === 'admin123') {
          localStorage.setItem('isLoggedIn', 'true');
          localStorage.setItem('currentUser', username);
          isLoggedIn = true;
          currentUser = username;
          loginModal.remove();
          initializeApp();
          showToast('Login successful! Welcome back, ' + username, 'success');
        } else {
          showToast('Invalid credentials! Use admin/admin123', 'error');
        }
      });
    }
    
    function togglePassword() {
      const passwordInput = document.getElementById('password');
      const toggleBtn = document.querySelector('.password-toggle i');
      
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleBtn.className = 'fas fa-eye-slash';
      } else {
        passwordInput.type = 'password';
        toggleBtn.className = 'fas fa-eye';
      }
    }
    
    function logout() {
      localStorage.setItem('isLoggedIn', 'false');
      isLoggedIn = false;
      document.getElementById('mainContainer').style.display = 'none';
      showLoginModal();
      showToast('Logged out successfully', 'success');
    }
    
    // Tab Navigation
    function showTab(tabId) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Deactivate all tab buttons
      document.querySelectorAll('.tab-btn').forEach(button => {
        button.classList.remove('active');
      });
      
      // Show selected tab content
      const tabContent = document.getElementById(tabId);
      if (tabContent) {
        tabContent.classList.add('active');
      }
      
      // Activate selected tab button
      const tabButton = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
      if (tabButton) {
        tabButton.classList.add('active');
      }
      
      // Load entries for the tab
      if (tabId !== 'dashboard' && tabId !== 'reports' && tabId !== 'ai-insights') {
        loadEntries(tabId);
      }
      
      // Update charts if dashboard or reports
      if (tabId === 'dashboard' || tabId === 'reports') {
        updateCharts();
      }
      
      // Update profit dashboard if showing
      if (tabId === 'dashboard') {
        updateProfitDashboard();
      }
    }
    
    // Theme Toggle
    function toggleTheme() {
      currentTheme = currentTheme === 'light' ? 'dark' : 'light';
      localStorage.setItem('theme', currentTheme);
      
      document.body.setAttribute('data-theme', currentTheme);
      const themeToggle = document.querySelector('.theme-toggle');
      
      if (currentTheme === 'dark') {
        themeToggle.innerHTML = '<i class="fas fa-sun"></i> <span>Light Mode</span>';
      } else {
        themeToggle.innerHTML = '<i class="fas fa-moon"></i> <span>Dark Mode</span>';
      }
      
      // Update charts with new theme colors
      updateCharts();
    }
    
    // Date and Time
    function updateDateTime() {
      const now = new Date();
      const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: true
      };
      document.getElementById('currentDateTime').textContent = now.toLocaleDateString('en-US', options);
    }
    
    // Initialize Charts
    function initCharts() {
      const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'top',
            labels: {
              color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary')
            }
          },
          tooltip: {
            mode: 'index',
            intersect: false,
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            titleColor: 'white',
            bodyColor: 'white',
            borderColor: 'rgba(255, 255, 255, 0.2)',
            borderWidth: 1
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary')
            },
            grid: {
              color: getComputedStyle(document.documentElement).getPropertyValue('--border-color')
            }
          },
          x: {
            ticks: {
              color: getComputedStyle(document.documentElement).getPropertyValue('--text-secondary')
            },
            grid: {
              color: getComputedStyle(document.documentElement).getPropertyValue('--border-color')
            }
          }
        }
      };
      
      // Inventory Chart (Bar)
      const inventoryCtx = document.getElementById('inventoryChart')?.getContext('2d');
      if (inventoryCtx) {
        charts.inventoryChart = new Chart(inventoryCtx, {
          type: 'bar',
          data: {
            labels: ['Inward', 'Outward', 'Returns', 'Expired'],
            datasets: [{
              label: 'Quantity (kg)',
              data: [0, 0, 0, 0],
              backgroundColor: [
                'rgba(16, 185, 129, 0.7)',
                'rgba(59, 130, 246, 0.7)',
                'rgba(249, 115, 22, 0.7)',
                'rgba(239, 68, 68, 0.7)'
              ],
              borderColor: [
                'rgba(16, 185, 129, 1)',
                'rgba(59, 130, 246, 1)',
                'rgba(249, 115, 22, 1)',
                'rgba(239, 68, 68, 1)'
              ],
              borderWidth: 1
            }]
          },
          options: chartOptions
        });
      }
      
      // Seed Distribution Chart (Doughnut)
      const seedCtx = document.getElementById('seedChart')?.getContext('2d');
      if (seedCtx) {
        charts.seedChart = new Chart(seedCtx, {
          type: 'doughnut',
          data: {
            labels: [],
            datasets: [{
              data: [],
              backgroundColor: [],
              borderColor: 'rgba(255, 255, 255, 0.1)',
              borderWidth: 1
            }]
          },
          options: {
            ...chartOptions,
            cutout: '70%'
          }
        });
      }
      
      // Expiry Status Chart (Pie)
      const expiryCtx = document.getElementById('expiryChart')?.getContext('2d');
      if (expiryCtx) {
        charts.expiryChart = new Chart(expiryCtx, {
          type: 'pie',
          data: {
            labels: ['Active', 'Expiring Soon', 'Expired'],
            datasets: [{
              data: [0, 0, 0],
              backgroundColor: [
                'rgba(16, 185, 129, 0.7)',
                'rgba(249, 115, 22, 0.7)',
                'rgba(239, 68, 68, 0.7)'
              ],
              borderColor: [
                'rgba(16, 185, 129, 1)',
                'rgba(249, 115, 22, 1)',
                'rgba(239, 68, 68, 1)'
              ],
              borderWidth: 1
            }]
          },
          options: {
            ...chartOptions,
            plugins: {
              ...chartOptions.plugins,
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return `${context.label}: ${context.raw}kg`;
                  }
                }
              }
            }
          }
        });
      }
      
      // Movement Chart (Line)
      const movementCtx = document.getElementById('movementChart')?.getContext('2d');
      if (movementCtx) {
        charts.movementChart = new Chart(movementCtx, {
          type: 'line',
          data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            datasets: [
              {
                label: 'Inward',
                data: [],
                borderColor: 'rgba(16, 185, 129, 1)',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                tension: 0.3,
                fill: true
              },
              {
                label: 'Outward',
                data: [],
                borderColor: 'rgba(59, 130, 246, 1)',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                tension: 0.3,
                fill: true
              }
            ]
          },
          options: chartOptions
        });
      }
      
      // Dashboard Movement Chart
      const dashboardMovementCtx = document.getElementById('dashboardMovementChart')?.getContext('2d');
      if (dashboardMovementCtx) {
        charts.dashboardMovementChart = new Chart(dashboardMovementCtx, {
          type: 'line',
          data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            datasets: [
              {
                label: 'Inward',
                data: [],
                borderColor: 'rgba(16, 185, 129, 1)',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                tension: 0.3,
                fill: true
              },
              {
                label: 'Outward',
                data: [],
                borderColor: 'rgba(59, 130, 246, 1)',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                tension: 0.3,
                fill: true
              }
            ]
          },
          options: chartOptions
        });
      }
      
      // Customer/Supplier Chart (Bar)
      const customerCtx = document.getElementById('customerChart')?.getContext('2d');
      if (customerCtx) {
        charts.customerChart = new Chart(customerCtx, {
          type: 'bar',
          data: {
            labels: [],
            datasets: [{
              label: 'Quantity (kg)',
              data: [],
              backgroundColor: 'rgba(59, 130, 246, 0.7)',
              borderColor: 'rgba(59, 130, 246, 1)',
              borderWidth: 1
            }]
          },
          options: chartOptions
        });
      }
    }
    
    // Update Charts with Data
    function updateCharts() {
      if (!charts.inventoryChart) return;

      // Inventory Summary Chart
      const totalInward = inventoryData.inward.reduce((sum, item) => sum + parseFloat(item.quantity || 0), 0);
      const totalOutward = inventoryData.outward.reduce((sum, item) => sum + parseFloat(item.quantity || 0), 0);
      const totalReturns = inventoryData.returns.reduce((sum, item) => sum + parseFloat(item.quantity || 0), 0);
      const totalExpired = inventoryData.expiry.reduce((sum, item) => sum + parseFloat(item.quantity || 0), 0);
      
      charts.inventoryChart.data.datasets[0].data = [totalInward, totalOutward, totalReturns, totalExpired];
      charts.inventoryChart.update();

      // Seed Distribution Chart
      const seedDistribution = {};
      inventoryData.inward.forEach(item => {
        seedDistribution[item.seedName] = (seedDistribution[item.seedName] || 0) + parseFloat(item.quantity || 0);
      });
      inventoryData.outward.forEach(item => {
        seedDistribution[item.seedName] = (seedDistribution[item.seedName] || 0) - parseFloat(item.quantity || 0);
      });
      inventoryData.returns.forEach(item => {
        seedDistribution[item.seedName] = (seedDistribution[item.seedName] || 0) + parseFloat(item.quantity || 0);
      });
      
      const seedLabels = Object.keys(seedDistribution).filter(seed => seedDistribution[seed] > 0);
      const seedData = seedLabels.map(seed => seedDistribution[seed]);
      
      // Generate distinct colors for each seed type
      const seedColors = seedLabels.map((_, i) => {
        const hue = (i * 137.508) % 360; // Golden angle for distinct colors
        return `hsla(${hue}, 70%, 60%, 0.7)`;
      });
      
      if (charts.seedChart) {
        charts.seedChart.data.labels = seedLabels;
        charts.seedChart.data.datasets[0].data = seedData;
        charts.seedChart.data.datasets[0].backgroundColor = seedColors;
        charts.seedChart.update();
      }

      // Expiry Status Chart (simplified example)
      if (charts.expiryChart) {
        const active = inventoryData.expiry.filter(item => item.action === 'used').reduce((sum, item) => sum + parseFloat(item.quantity || 0), 0);
        const expired = inventoryData.expiry.filter(item => item.action === 'destroyed').reduce((sum, item) => sum + parseFloat(item.quantity || 0), 0);
        const expiringSoon = inventoryData.expiry.filter(item => item.action === 'returned').reduce((sum, item) => sum + parseFloat(item.quantity || 0), 0);
        
        charts.expiryChart.data.datasets[0].data = [active, expiringSoon, expired];
        charts.expiryChart.update();
      }

      // Movement Chart (by month)
      if (charts.movementChart) {
        const monthlyInward = Array(12).fill(0);
        const monthlyOutward = Array(12).fill(0);
        
        inventoryData.inward.forEach(item => {
          const month = new Date(item.date).getMonth();
          monthlyInward[month] += parseFloat(item.quantity || 0);
        });
        
        inventoryData.outward.forEach(item => {
          const month = new Date(item.date).getMonth();
          monthlyOutward[month] += parseFloat(item.quantity || 0);
        });
        
        charts.movementChart.data.datasets[0].data = monthlyInward;
        charts.movementChart.data.datasets[1].data = monthlyOutward;
        charts.movementChart.update();
      }

      // Dashboard Movement Chart
      if (charts.dashboardMovementChart) {
        const monthlyInward = Array(12).fill(0);
        const monthlyOutward = Array(12).fill(0);
        
        inventoryData.inward.forEach(item => {
          const month = new Date(item.date).getMonth();
          monthlyInward[month] += parseFloat(item.quantity || 0);
        });
        
        inventoryData.outward.forEach(item => {
          const month = new Date(item.date).getMonth();
          monthlyOutward[month] += parseFloat(item.quantity || 0);
        });
        
        charts.dashboardMovementChart.data.datasets[0].data = monthlyInward;
        charts.dashboardMovementChart.data.datasets[1].data = monthlyOutward;
        charts.dashboardMovementChart.update();
      }

      // Customer/Supplier Chart (top 5)
      if (charts.customerChart) {
        const customerData = {};
        inventoryData.outward.forEach(item => {
          customerData[item.party] = (customerData[item.party] || 0) + parseFloat(item.quantity || 0);
        });
        
        const sortedCustomers = Object.entries(customerData)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 5);
        
        charts.customerChart.data.labels = sortedCustomers.map(item => item[0]);
        charts.customerChart.data.datasets[0].data = sortedCustomers.map(item => item[1]);
        charts.customerChart.update();
      }
      
      // Update dashboard stats
      document.getElementById('totalStock').textContent = (totalInward - totalOutward + totalReturns - totalExpired).toFixed(1);
      
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('totalInward').textContent = inventoryData.inward
        .filter(item => item.date === today)
        .reduce((sum, item) => sum + parseFloat(item.quantity || 0), 0).toFixed(1);
      
      document.getElementById('totalOutward').textContent = inventoryData.outward
        .filter(item => item.date === today)
        .reduce((sum, item) => sum + parseFloat(item.quantity || 0), 0).toFixed(1);
      
      // Update expiring soon count
      const nextWeek = new Date();
      nextWeek.setDate(nextWeek.getDate() + 7);
      const nextWeekStr = nextWeek.toISOString().split('T')[0];
      
      document.getElementById('expiringSoon').textContent = inventoryData.expiry
        .filter(item => item.expiryDate >= today && item.expiryDate <= nextWeekStr)
        .reduce((sum, item) => sum + parseFloat(item.quantity || 0), 0).toFixed(1);
    }
    
    // Profit Dashboard
    function updateProfitDashboard() {
      // Calculate sample profit/loss data (in a real app, this would come from your data)
      const sampleRevenue = inventoryData.outward.reduce((sum, item) => sum + (parseFloat(item.quantity || 0) * 100), 0); // Assuming ₹100 per kg
      const sampleCosts = inventoryData.inward.reduce((sum, item) => sum + (parseFloat(item.quantity || 0) * 70), 0); // Assuming ₹70 per kg cost
      const profit = sampleRevenue - sampleCosts;
      const margin = sampleRevenue > 0 ? ((profit / sampleRevenue) * 100).toFixed(1) : 0;
      
      // Update the dashboard elements
      document.getElementById('totalRevenue').textContent = '₹' + sampleRevenue.toLocaleString();
      document.getElementById('totalCosts').textContent = '₹' + sampleCosts.toLocaleString();
      document.getElementById('grossProfit').textContent = '₹' + profit.toLocaleString();
      document.getElementById('profitMargin').textContent = margin + '%';
    }
    
    function generateProfitReport() {
      updateProfitDashboard();
      showToast('Profit & Loss report generated!', 'success');
    }
    
    // Form Handling
    function setupEventListeners() {
      // Inward Form
      const inwardForm = document.getElementById('inwardForm');
      if (inwardForm) {
        inwardForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const formData = new FormData(this);
          const data = Object.fromEntries(formData);
          const errors = validateForm(data, 'inward');
          
          if (errors.length > 0) {
            showToast(errors.join('<br>'), 'error');
            return;
          }
          
          saveData('inward', data)
            .then(() => {
              this.reset();
              setDefaultDates();
              showToast('Inward entry added successfully!', 'success');
            })
            .catch(err => {
              showToast('Error saving data: ' + err.message, 'error');
            });
        });
      }
      
      // Outward Form
      const outwardForm = document.getElementById('outwardForm');
      if (outwardForm) {
        outwardForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const formData = new FormData(this);
          const data = Object.fromEntries(formData);
          const errors = validateForm(data, 'outward');
          
          if (errors.length > 0) {
            showToast(errors.join('<br>'), 'error');
            return;
          }
          
          saveData('outward', data)
            .then(() => {
              this.reset();
              setDefaultDates();
              showToast('Outward entry added successfully!', 'success');
            })
            .catch(err => {
              showToast('Error saving data: ' + err.message, 'error');
            });
        });
      }
      
      // Returns Form
      const returnsForm = document.getElementById('returnsForm');
      if (returnsForm) {
        returnsForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const formData = new FormData(this);
          const data = Object.fromEntries(formData);
          const errors = validateForm(data, 'returns');
          
          if (errors.length > 0) {
            showToast(errors.join('<br>'), 'error');
            return;
          }
          
          saveData('returns', data)
            .then(() => {
              this.reset();
              setDefaultDates();
              showToast('Return entry added successfully!', 'success');
            })
            .catch(err => {
              showToast('Error saving data: ' + err.message, 'error');
            });
        });
      }
      
      // Expiry Form
      const expiryForm = document.getElementById('expiryForm');
      if (expiryForm) {
        expiryForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const formData = new FormData(this);
          const data = Object.fromEntries(formData);
          const errors = validateForm(data, 'expiry');
          
          if (errors.length > 0) {
            showToast(errors.join('<br>'), 'error');
            return;
          }
          
          saveData('expiry', data)
            .then(() => {
              this.reset();
              setDefaultDates();
              showToast('Expiry entry added successfully!', 'success');
            })
            .catch(err => {
              showToast('Error saving data: ' + err.message, 'error');
            });
        });
      }
      
      // Profit report generation
      document.getElementById('generateProfitReport')?.addEventListener('click', generateProfitReport);
      
      // AI Assistant features
      document.querySelectorAll('.ai-feature-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          askAI(this.dataset.feature);
        });
      });
      
      // Chat input
      document.getElementById('chatInput')?.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          sendChatMessage();
        }
      });
      
      document.getElementById('sendChatBtn')?.addEventListener('click', sendChatMessage);
      document.getElementById('voiceInputBtn')?.addEventListener('click', startVoiceInput);
      
      // Export and print buttons
      document.querySelectorAll('.export-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          exportToCSV(this.dataset.type);
        });
      });
      
      document.querySelectorAll('.print-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          printReport(this.dataset.type);
        });
      });
    }
    
    // Form Validation
    function validateForm(formData, type) {
      const errors = [];
      if (!formData.seedName || formData.seedName.trim() === '') {
        errors.push('Seed name is required');
      }
      if (!formData.quantity || isNaN(formData.quantity)) {
        errors.push('Quantity must be a number');
      } else if (parseFloat(formData.quantity) <= 0) {
        errors.push('Quantity must be greater than 0');
      }
      if (!formData.date) {
        errors.push('Date is required');
      }
      if ((type === 'inward' || type === 'outward') && (!formData.party || formData.party.trim() === '')) {
        errors.push(`${type === 'inward' ? 'Supplier' : 'Customer'} name is required`);
      }
      if (type === 'expiry' && !formData.expiryDate) {
        errors.push('Expiry date is required');
      }
      return errors;
    }
    
    // Save Data
    async function saveData(type, data) {
      return new Promise((resolve, reject) => {
        try {
          // Add unique ID and timestamp
          data.id = Date.now().toString();
          data.timestamp = new Date().toISOString();
          
          // Push to appropriate array
          inventoryData[type].unshift(data);
          
          // Save to localStorage
          localStorage.setItem('inventoryData', JSON.stringify(inventoryData));
          
          // Update charts and UI
          updateCharts();
          updateProfitDashboard();
          loadEntries(type);
          
          resolve();
        } catch (error) {
          reject(error);
        }
      });
    }
    
    // Load Entries
    function loadEntries(type) {
      const container = document.getElementById(`${type}Entries`);
      if (!container) return;
      
      // Sort by date (newest first)
      const sortedData = [...inventoryData[type]].sort((a, b) => new Date(b.date) - new Date(a.date));
      
      container.innerHTML = sortedData.map(entry => `
        <div class="entry-card" data-id="${entry.id}">
          <div class="entry-header">
            <h4>${entry.seedName}</h4>
            <span class="quantity-badge">${parseFloat(entry.quantity).toFixed(2)} kg</span>
          </div>
          <div class="entry-details">
            <p><strong>Date:</strong> ${entry.date}</p>
            ${type === 'inward' || type === 'outward' ? `<p><strong>${type === 'inward' ? 'Supplier' : 'Customer'}:</strong> ${entry.party}</p>` : ''}
            ${type === 'returns' ? `<p><strong>Reason:</strong> ${entry.reason}</p>` : ''}
            ${type === 'expiry' ? `<p><strong>Expiry Date:</strong> ${entry.expiryDate}</p>` : ''}
            <p><strong>Notes:</strong> ${entry.notes || 'N/A'}</p>
          </div>
          <div class="entry-actions">
            <button class="btn btn-sm btn-edit" onclick="editEntry('${type}', '${entry.id}')">
              <i class="fas fa-edit"></i> Edit
            </button>
            <button class="btn btn-sm btn-delete" onclick="deleteEntry('${type}', '${entry.id}')">
              <i class="fas fa-trash"></i> Delete
            </button>
          </div>
        </div>
      `).join('');
    }
    
    // Edit Entry
    function editEntry(type, id) {
      const entry = inventoryData[type].find(item => item.id === id);
      if (!entry) return;

      const form = document.getElementById(`${type}Form`);
      if (!form) return;

      // Fill form with entry data
      Object.keys(entry).forEach(key => {
        const input = form.querySelector(`[name="${key}"]`);
        if (input) {
          input.value = entry[key];
        }
      });

      // Change submit button to update
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Entry';
      submitBtn.onclick = function(e) {
        e.preventDefault();
        updateEntry(type, id);
      };

      // Scroll to form
      form.scrollIntoView({ behavior: 'smooth' });
    }
    
    // Update Entry
    function updateEntry(type, id) {
      const form = document.getElementById(`${type}Form`);
      if (!form) return;

      const formData = new FormData(form);
      const data = Object.fromEntries(formData);
      const errors = validateForm(data, type);
      
      if (errors.length > 0) {
        showToast(errors.join('<br>'), 'error');
        return;
      }

      // Find and update entry
      const index = inventoryData[type].findIndex(item => item.id === id);
      if (index !== -1) {
        inventoryData[type][index] = { ...data, id };
        localStorage.setItem('inventoryData', JSON.stringify(inventoryData));
        
        // Reset form and UI
        form.reset();
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.innerHTML = '<i class="fas fa-plus"></i> Add Entry';
        submitBtn.onclick = function(e) {
          e.preventDefault();
          form.dispatchEvent(new Event('submit'));
        };
        
        loadEntries(type);
        updateCharts();
        updateProfitDashboard();
        showToast('Entry updated successfully!', 'success');
      }
    }
    
    // Delete Entry
    function deleteEntry(type, id) {
      if (!confirm('Are you sure you want to delete this entry?')) return;

      inventoryData[type] = inventoryData[type].filter(item => item.id !== id);
      localStorage.setItem('inventoryData', JSON.stringify(inventoryData));
      
      loadEntries(type);
      updateCharts();
      updateProfitDashboard();
      showToast('Entry deleted successfully!', 'success');
    }
    
    // Set Default Dates
    function setDefaultDates() {
      const today = new Date().toISOString().split('T')[0];
      document.querySelectorAll('input[type="date"]').forEach(input => {
        if (!input.value) {
          input.value = today;
        }
      });
    }
    
    // Check for Low Inventory
    function checkLowInventory() {
      const seedStock = {};
      
      // Calculate current stock
      inventoryData.inward.forEach(item => {
        seedStock[item.seedName] = (seedStock[item.seedName] || 0) + parseFloat(item.quantity || 0);
      });
      inventoryData.outward.forEach(item => {
        seedStock[item.seedName] = (seedStock[item.seedName] || 0) - parseFloat(item.quantity || 0);
      });
      inventoryData.returns.forEach(item => {
        seedStock[item.seedName] = (seedStock[item.seedName] || 0) + parseFloat(item.quantity || 0);
      });
      
      // Check for low stock
      const lowStockItems = [];
      const criticalStockItems = [];
      
      Object.entries(seedStock).forEach(([seedName, stock]) => {
        if (stock <= 5 && stock > 0) {
          criticalStockItems.push({ seedName, stock });
        } else if (stock <= 15) {
          lowStockItems.push({ seedName, stock });
        }
      });
      
      if (criticalStockItems.length > 0) {
        const message = `Critical stock alert! ${criticalStockItems.map(item => 
          `${item.seedName}: ${item.stock.toFixed(1)}kg`
        ).join(', ')}`;
        showToast(message, 'error', 10000);
      } else if (lowStockItems.length > 0) {
        const message = `Low stock warning! ${lowStockItems.map(item => 
          `${item.seedName}: ${item.stock.toFixed(1)}kg`
        ).join(', ')}`;
        showToast(message, 'warning', 8000);
      }
    }
    
    // Print Report
    function printReport() {
      const printWindow = window.open('', '_blank');
      const title = 'Inventory Report';
      
      let htmlContent = `
        <html>
          <head>
            <title>${title}</title>
            <style>
              body { font-family: Arial, sans-serif; margin: 20px; }
              h1 { color: #333; text-align: center; }
              table { width: 100%; border-collapse: collapse; margin-top: 20px; }
              th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
              th { background-color: #f2f2f2; }
              .footer { margin-top: 20px; text-align: right; font-size: 0.8em; }
            </style>
          </head>
          <body>
            <h1>${title}</h1>
            <p>Generated on: ${new Date().toLocaleString()}</p>
            <p>Generated by: ${currentUser}</p>
      `;
      
      // Add inventory summary
      const totalInward = inventoryData.inward.reduce((sum, item) => sum + parseFloat(item.quantity || 0), 0);
      const totalOutward = inventoryData.outward.reduce((sum, item) => sum + parseFloat(item.quantity || 0), 0);
      const totalReturns = inventoryData.returns.reduce((sum, item) => sum + parseFloat(item.quantity || 0), 0);
      const totalExpired = inventoryData.expiry.reduce((sum, item) => sum + parseFloat(item.quantity || 0), 0);
      
      htmlContent += `
        <h2>Inventory Summary</h2>
        <table>
          <tr>
            <th>Type</th>
            <th>Quantity (kg)</th>
          </tr>
          <tr>
            <td>Inward</td>
            <td>${totalInward.toFixed(2)}</td>
          </tr>
          <tr>
            <td>Outward</td>
            <td>${totalOutward.toFixed(2)}</td>
          </tr>
          <tr>
            <td>Returns</td>
            <td>${totalReturns.toFixed(2)}</td>
          </tr>
          <tr>
            <td>Expired</td>
            <td>${totalExpired.toFixed(2)}</td>
          </tr>
          <tr>
            <td><strong>Current Stock</strong></td>
            <td><strong>${(totalInward - totalOutward + totalReturns - totalExpired).toFixed(2)}</strong></td>
          </tr>
        </table>
      `;
      
      // Add detailed entries for each type
      ['inward', 'outward', 'returns', 'expiry'].forEach(type => {
        if (inventoryData[type].length > 0) {
          const typeName = type.charAt(0).toUpperCase() + type.slice(1);
          htmlContent += `
            <h2>${typeName} Entries</h2>
            <table>
              <thead>
                <tr>
                  <th>Seed Name</th>
                  <th>Quantity (kg)</th>
                  <th>Date</th>
                  ${type === 'inward' || type === 'outward' ? '<th>' + (type === 'inward' ? 'Supplier' : 'Customer') + '</th>' : ''}
                  ${type === 'returns' ? '<th>Reason</th>' : ''}
                  ${type === 'expiry' ? '<th>Expiry Date</th><th>Action</th>' : ''}
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody>
          `;
          
          inventoryData[type].forEach(entry => {
            htmlContent += `
              <tr>
                <td>${entry.seedName}</td>
                <td>${parseFloat(entry.quantity).toFixed(2)}</td>
                <td>${entry.date}</td>
                ${type === 'inward' || type === 'outward' ? `<td>${entry.party}</td>` : ''}
                ${type === 'returns' ? `<td>${entry.reason}</td>` : ''}
                ${type === 'expiry' ? `<td>${entry.expiryDate}</td><td>${entry.action}</td>` : ''}
                <td>${entry.notes || 'N/A'}</td>
              </tr>
            `;
          });
          
          htmlContent += `
              </tbody>
            </table>
          `;
        }
      });
      
      htmlContent += `
            <div class="footer">
              <p>Generated by Hybrid Seed Inventory Pro</p>
            </div>
          </body>
        </html>
      `;
      
      printWindow.document.open();
      printWindow.document.write(htmlContent);
      printWindow.document.close();
      
      setTimeout(() => {
        printWindow.print();
        printWindow.close();
      }, 500);
    }
    
    // Export Data
    function exportData() {
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(inventoryData, null, 2));
      const downloadAnchor = document.createElement('a');
      downloadAnchor.setAttribute('href', dataStr);
      downloadAnchor.setAttribute('download', "inventory_data_" + new Date().toISOString().slice(0,10) + ".json");
      document.body.appendChild(downloadAnchor);
      downloadAnchor.click();
      document.body.removeChild(downloadAnchor);
      showToast('Data exported successfully!', 'success');
    }
    
    // AI Assistant Functions
    function askAI(feature) {
      const responses = {
        'inventory-optimization': 'Based on your current stock levels and sales patterns, I recommend maintaining 15-20 days of safety stock for wheat seeds and reducing corn seed inventory by 10%.',
        'demand-forecasting': 'Seasonal analysis shows 35% increase in vegetable seed demand expected next month. Consider increasing tomato and cabbage seed stock.',
        'profit-analysis': 'Premium hybrid varieties show 42% higher profit margins. Focus on promoting varieties with batch codes starting with "HYB" for maximum profitability.',
        'market-insights': 'Current market trends indicate organic seeds are in high demand with 25% price premium. Consider expanding organic seed varieties.'
      };
      
      // Add the response to chat
      const chatMessages = document.getElementById('chatMessages');
      const aiMsg = document.createElement('div');
      aiMsg.className = 'ai-message';
      aiMsg.innerHTML = `<strong>AI Assistant:</strong> ${responses[feature]}`;
      chatMessages.appendChild(aiMsg);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      showToast('AI recommendation generated!', 'success');
    }
    
    function sendChatMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      if (!message) return;
      
      const chatMessages = document.getElementById('chatMessages');
      
      // Add user message
      const userMsg = document.createElement('div');
      userMsg.className = 'user-message';
      userMsg.innerHTML = '<strong>You:</strong> ' + message;
      chatMessages.appendChild(userMsg);
      
      // Clear input
      input.value = '';
      
      // Simulate AI thinking
      const thinkingMsg = document.createElement('div');
      thinkingMsg.className = 'ai-message thinking';
      thinkingMsg.innerHTML = '<strong>AI Assistant:</strong> Thinking...';
      chatMessages.appendChild(thinkingMsg);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      // Simulate AI response after delay
      setTimeout(() => {
        thinkingMsg.remove();
        
        const aiResponse = generateAIResponse(message);
        const aiMsg = document.createElement('div');
        aiMsg.className = 'ai-message';
        aiMsg.innerHTML = '<strong>AI Assistant:</strong> ' + aiResponse;
        chatMessages.appendChild(aiMsg);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }, 1500);
    }
    
    function generateAIResponse(message) {
      // This would be replaced with actual AI API calls in a real implementation
      const responses = [
        "Based on your inventory data, I recommend increasing stock of wheat seeds by 15% for the coming season.",
        "Your current profit margin is 28%, which is above industry average. Consider focusing on high-margin hybrid varieties.",
        "I've analyzed your sales patterns and found that weekends see 40% higher sales volume. Adjust staffing accordingly.",
        "The market trends show increasing demand for organic seeds. You might want to expand your organic offerings.",
        "Your inventory turnover ratio is 3.2, which is good. Try to maintain it between 3-4 for optimal efficiency.",
        "Based on weather predictions, expect higher demand for drought-resistant varieties in the next quarter."
      ];
      
      // Simple keyword-based response selection
      if (message.toLowerCase().includes('profit')) {
        return responses[1];
      } else if (message.toLowerCase().includes('stock') || message.toLowerCase().includes('inventory')) {
        return responses[0];
      } else if (message.toLowerCase().includes('sales') || message.toLowerCase().includes('trend')) {
        return responses[2];
      } else if (message.toLowerCase().includes('market')) {
        return responses[3];
      } else if (message.toLowerCase().includes('turnover')) {
        return responses[4];
      } else if (message.toLowerCase().includes('weather')) {
        return responses[5];
      }
      
      // Default random response
      return responses[Math.floor(Math.random() * responses.length)];
    }
    
    // Voice Command Functions
    function startVoiceCommand() {
      if (!('webkitSpeechRecognition' in window)) {
        showToast('Voice commands not supported in your browser', 'error');
        return;
      }
      
      const recognition = new webkitSpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      
      recognition.onstart = function() {
        showToast('Listening... Speak now', 'info');
      };
      
      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript.toLowerCase();
        processVoiceCommand(transcript);
      };
      
      recognition.onerror = function(event) {
        showToast('Voice recognition error: ' + event.error, 'error');
      };
      
      recognition.start();
    }
    
    function processVoiceCommand(command) {
      showToast('Command: ' + command, 'info');
      
      // Simple voice command processing
      if (command.includes('profit') || command.includes('margin')) {
        askAI('profit-analysis');
      } else if (command.includes('stock') || command.includes('inventory')) {
        askAI('inventory-optimization');
      } else if (command.includes('demand') || command.includes('forecast')) {
        askAI('demand-forecasting');
      } else if (command.includes('market') || command.includes('trend')) {
        askAI('market-insights');
      } else if (command.includes('dashboard')) {
        showTab('dashboard');
      } else if (command.includes('report')) {
        showTab('reports');
      } else {
        showToast('I didn\'t understand that command. Try "show me profit trends" or "inventory optimization"', 'warning');
      }
    }
    
    function startVoiceInput() {
      if (!('webkitSpeechRecognition' in window)) {
        showToast('Voice input not supported in your browser', 'error');
        return;
      }
      
      const recognition = new webkitSpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      
      recognition.onstart = function() {
        showToast('Listening for your message...', 'info');
      };
      
      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        document.getElementById('chatInput').value = transcript;
      };
      
      recognition.onerror = function(event) {
        showToast('Voice input error: ' + event.error, 'error');
      };
      
      recognition.start();
    }
    
    // Toast Notifications
    function showToast(message, type = 'info', duration = 3000) {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      
      const icon = {
        success: 'check-circle',
        error: 'exclamation-circle',
        warning: 'exclamation-triangle',
        info: 'info-circle'
      }[type];
      
      toast.innerHTML = `<i class="fas fa-${icon}"></i> ${message}`;
      document.body.appendChild(toast);
      
      // Remove toast after duration
      setTimeout(() => {
        toast.remove();
      }, duration);
    }
    
    // Initialize with some sample data if empty
    function initializeSampleData() {
      if (inventoryData.inward.length === 0) {
        const today = new Date();
        const lastMonth = new Date();
        lastMonth.setMonth(lastMonth.getMonth() - 1);
        
        inventoryData.inward = [
          {
            id: '1',
            seedName: 'Wheat Hybrid',
            quantity: '100',
            party: 'SeedCo Inc.',
            date: formatDate(lastMonth),
            notes: 'Initial stock'
          },
          {
            id: '2',
            seedName: 'Rice Premium',
            quantity: '75',
            party: 'AgriSeeds Ltd.',
            date: formatDate(today),
            notes: 'New variety'
          }
        ];
        
        inventoryData.outward = [
          {
            id: '3',
            seedName: 'Wheat Hybrid',
            quantity: '30',
            party: 'Farmers Co-op',
            date: formatDate(today),
            notes: 'Regular order'
          }
        ];
        
        localStorage.setItem('inventoryData', JSON.stringify(inventoryData));
      }
    }
    
    function formatDate(date) {
      return date.toISOString().split('T')[0];
    }
    
    // Call initialization
    initializeSampleData();
  </script>
</body>
</html>